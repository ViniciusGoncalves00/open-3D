<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Three.js + TypeScript</title>
  <style>
    html, body {
      margin: 0;
      height: 100%;
    }

    #c {
      width: 100%;
      height: 100%;
      display: block;
    }

    .dropzone {
      border: 2px dashed #fff;
      opacity: 0.5;
    }

    .dropzone.hovered {
      border-color: lime;
    }

    .active {
      display: block;
    }

    .draggable {
      cursor: grab;
    }
  </style>

  <script type="module" src="./dist/bundle.js"></script>
</head>
<body>
  <div id="explorer-window" class="bg-zinc-900 w-full h-full flex space-x-[1px]">
    <div id="drag-n-drop-overlay" class="z-50 absolute w-full h-full bg-black/50"></div>

    <!-- LEFT -->
    <div id="left" class="bg-zinc-800 w-2/12 h-full flex flex-col relative">
      <div class="dropzone">drop</div>
      <div id="Hierarchy" class="bg-zinc-800 w-full h-full">
        <div class="title-bar bg-zinc-700 text-white px-2 py-1 draggable cursor-grab">
          Hierarchy
        </div>
        <div class="content p-2">
        </div>
      </div>
      <div id="Assets" class="bg-zinc-800 w-full h-full">
        <div class="title-bar bg-zinc-700 text-white px-2 py-1 draggable cursor-grab">
          Assets
        </div>
        <div class="content p-2">
        </div>
      </div>
      
    </div>

    <!-- CENTER -->
    <div id="center" class="bg-zinc-800 w-8/12 h-full flex flex-col relative">
      <div class="dropzone">drop</div>

      <div id="time-controls" class="w-full h-8 flex items-center justify-center">
        <button id="stop" class="btn btn--time-controller">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-stop" viewBox="0 0 16 16">
            <path d="M3.5 5A1.5 1.5 0 0 1 5 3.5h6A1.5 1.5 0 0 1 12.5 5v6a1.5 1.5 0 0 1-1.5 1.5H5A1.5 1.5 0 0 1 3.5 11zM5 4.5a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 .5.5h6a.5.5 0 0 0 .5-.5V5a.5.5 0 0 0-.5-.5z"/>
          </svg>
        </button>
        <button id="pause" class="btn btn--time-controller">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-pause" viewBox="0 0 16 16">
            <path d="M6 3.5a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5m4 0a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5"/>
          </svg>
        </button>
        <button id="play" class="btn btn--time-controller">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-play" viewBox="0 0 16 16">
            <path d="M10.804 8 5 4.633v6.734zm.792-.696a.802.802 0 0 1 0 1.392l-6.363 3.692C4.713 12.69 4 12.345 4 11.692V4.308c0-.653.713-.998 1.233-.696z"/>
          </svg>
        </button>
      </div>

      <div id="tabs" class="w-full h-8 flex items-center justify-center">
        <button id="editor-tab" class="w-16 h-full bg-gray-200 border border-gray-400 flex items-center justify-center">
          editor
        </button>
        <button id="run-tab" class="w-16 h-full bg-gray-200 border border-gray-400 flex items-center justify-center">
          run
        </button>
      </div>

      <div id="viewport-container" class="w-full h-full flex space-x-[1px]">
        <div id="viewport-editor" class="w-full h-full"></div>
        <div id="viewport-run" class="w-full h-full"></div>
      </div>

      <div id="Console" class="bg-zinc-800 w-full h-full">
        <div class="title-bar bg-zinc-700 text-white px-2 py-1 draggable cursor-grab">
          Console
        </div>
        <div class="content p-2">
        </div>
      </div>
    </div>

    <!-- RIGHT -->
    <div id="right" class="bg-zinc-800 w-2/12 h-full flex flex-col relative">
      <div class="dropzone">drop</div>

      <div id="Inspector" class="bg-zinc-800 w-full h-full">
        <div class="title-bar bg-zinc-700 text-white px-2 py-1 draggable cursor-grab">
          Inspector
        </div>
        <div class="content p-2">
        </div>
      </div>
    </div>
  </div>

  <script>
    const overlay = document.getElementById("drag-n-drop-overlay");
    const dropzones = document.querySelectorAll(".dropzone");
    let ghost = null;
    let offsetX = 0;
    let offsetY = 0;
    let isDragging = false;
    let draggedElement = null;
  
    const makeDraggable = (element) => {
      const titleBar = element.querySelector(".title-bar");
      if (!titleBar) return;
    
      titleBar.addEventListener("mousedown", (e) => {
        isDragging = true;
        draggedElement = element;
        offsetX = e.offsetX;
        offsetY = e.offsetY;
    
        // Impede scroll
        document.body.classList.add("no-scroll");
        document.documentElement.classList.add("no-scroll");
    
        // Cria uma cópia visual da div
        ghost = element.cloneNode(true);
        ghost.id = "ghost";
        ghost.style.position = "absolute";
        ghost.style.width = "128px";
        ghost.style.height = "128px";
        ghost.style.pointerEvents = "none";
        ghost.style.opacity = 0.7;
        ghost.style.zIndex = 1000;
    
        // Exemplo de personalização visual:
        ghost.innerText = "Arrastando..."; 
        document.body.appendChild(ghost);
    
        const ghostWidth = ghost.offsetWidth;
        const ghostHeight = ghost.offsetHeight;
    
        ghost.style.left = `${e.clientX - ghostWidth / 2}px`;
        ghost.style.top = `${e.clientY - ghostHeight / 2}px`;
    
        // Evita que o clique vá para outros elementos
        e.stopPropagation();
      });
    };
    
  
    document.addEventListener("mousemove", (e) => {
      if (!isDragging || !ghost) return;
  
      // Move o ghost centralizado na posição do mouse
      const ghostWidth = ghost.offsetWidth;
      const ghostHeight = ghost.offsetHeight;
  
      ghost.style.left = `${e.clientX - ghostWidth / 2}px`;
      ghost.style.top = `${e.clientY - ghostHeight / 2}px`;
  
      // Mostra overlay
      overlay.classList.add("active");
  
      dropzones.forEach(zone => {
        zone.classList.add("active");
  
        const rect = zone.getBoundingClientRect();
        const inside =
          e.clientX >= rect.left &&
          e.clientX <= rect.right &&
          e.clientY >= rect.top &&
          e.clientY <= rect.bottom;
  
        zone.classList.remove("hovered");
        if (inside) {
          zone.classList.add("hovered");
        }
      });
    });
  
    document.addEventListener("mouseup", (e) => {
      if (!isDragging) return;
      isDragging = false;
  
      // Remove scroll lock
      document.body.classList.remove("no-scroll");
      document.documentElement.classList.remove("no-scroll");
  
      let dropped = false;
  
      dropzones.forEach(zone => {
        const rect = zone.getBoundingClientRect();
        const inside =
          e.clientX >= rect.left &&
          e.clientX <= rect.right &&
          e.clientY >= rect.top &&
          e.clientY <= rect.bottom;
  
        zone.classList.remove("border-lime-400", "text-white");
  
        if (inside) {
          // Move o item original para a zona
          draggedElement.style.position = "relative";
          draggedElement.style.left = "0px";
          draggedElement.style.top = "0px";
          draggedElement.style.zIndex = "auto";
          draggedElement.style.transform = "none";
  
          zone.parentElement.appendChild(draggedElement);
          dropped = true;
        }
      });
  
      // Se não foi solto numa zona válida, volta para o local original
      if (!dropped) {
        draggedElement.style.position = "relative";
        draggedElement.style.left = "0px";
        draggedElement.style.top = "0px";
        draggedElement.style.zIndex = "auto";
        document.getElementById("center").appendChild(draggedElement);
      }
  
      // Limpa ghost e overlay
      overlay.classList.remove("active");
      dropzones.forEach(zone => zone.classList.remove("active"));
      if (ghost) {
        ghost.remove();
        ghost = null;
      }
    });
  
    // Torna as divs arrastáveis
    makeDraggable(document.getElementById("Hierarchy"));
    makeDraggable(document.getElementById("Assets"));
    makeDraggable(document.getElementById("Inspector"));
    makeDraggable(document.getElementById("Console"));
  </script>
  
</body>
</html>
